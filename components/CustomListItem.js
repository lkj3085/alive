import React, { useEffect, useState } from "react";
import { StyleSheet, View, Text } from "react-native";
import { ListItem, Avatar } from "react-native-elements";
import { Subscriber } from "rxjs";
import { db } from "../firebase";

const CustomListItem = ({ id, chatName, enterChat }) => {
  const [chatMessages, setChatMessages] = useState([]);

  useEffect(() => {
    const unsubcribe = db
      .collection("chats")
      .doc(id)
      .collection("messages")
      .orderBy("timestamp", "desc")
      .onSnapshot((snapshot) =>
        setChatMessages(snapshot.docs.map((doc) => doc.data()))
      );

    return unsubcribe;
  });

  return (
    <ListItem onPress={() => enterChat(id, chatName)} key={id} bottomDivider>
      <Avatar
        rounded
        source={{
          uri:
            chatMessages?.[0]?.photoURL ||
            "data:image/jpeg;base64,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",
        }}
      />
      <ListItem.Content>
        <ListItem.Title style={{ fontWeight: "800" }}>
          {chatName}
        </ListItem.Title>
        <ListItem.Subtitle numberOfLines={1} ellipsizeMode="tail">
          {chatMessages?.[0]?.displayName}: {chatMessages?.[0]?.message}
        </ListItem.Subtitle>
      </ListItem.Content>
    </ListItem>
  );
};

export default CustomListItem;

const styles = StyleSheet.create({});
